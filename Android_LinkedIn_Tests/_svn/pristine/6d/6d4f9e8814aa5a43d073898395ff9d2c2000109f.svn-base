package com.linkedin.android.screens.updates;

import java.util.Calendar;

import junit.framework.Assert;
import android.text.format.DateFormat;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;

import com.linkedin.android.screens.base.ScreenExpose;
import com.linkedin.android.tests.data.DataProvider;
import com.linkedin.android.tests.data.Id;
import com.linkedin.android.tests.data.ViewIdName;
import com.linkedin.android.utils.HardwareActions;
import com.linkedin.android.utils.Logger;
import com.linkedin.android.utils.WaitActions;
import com.linkedin.android.utils.viewUtils.ViewUtils;

/**
 * Class for CALENDAR screen.
 * 
 * @author alexey.makhalov
 * @created Aug 30, 2012 11:55 AM
 */
public class ScreenCalendar extends ScreenExpose {
    // CONSTANTS ------------------------------------------------------------
    public static final String ACTIVITY_CLASSNAME = "com.linkedin.android.spotlight.CalendarListActivity";

    public static final String ACTIVITY_SHORT_CLASSNAME = "CalendarListActivity";

    // PROPERTIES -----------------------------------------------------------

    // CONSTRUCTORS ---------------------------------------------------------
    public ScreenCalendar() {
        super(ACTIVITY_CLASSNAME);
    }

    // METHODS --------------------------------------------------------------

    public void verify() {
        // TODO add more conditions?
        Assert.assertTrue("'CALENDAR' screen is not present",
                getSolo().waitForText("Calendar", 1, DataProvider.WAIT_DELAY_SHORT, false, false));

        HardwareActions.takeCurrentActivityScreenshot("CALENDAR screen");
    };

    @Override
    public String getActivityShortClassName() {
        return ACTIVITY_SHORT_CLASSNAME;
    }

    @Override
    public void waitForMe() {
        WaitActions.waitMultiplyActivities(new String[] { ACTIVITY_SHORT_CLASSNAME });
    }

    /**
     * Taps on Calendar.
     */
    static public ScreenCalendar tapOnCalendarBigImage() {
        View calendarBigImage = Id.getViewByName(ViewIdName.NUS_SPOTLIGHT_CALENDAR_IMAGE);
        ViewUtils.tapOnView(calendarBigImage, "calendar big image");
        return new ScreenCalendar();
    }

    /**
     * Opens any Meeting.
     */
    public ScreenCalendarEventDetail openAnyMeeting() {
        TextView article = null;
        if (getSolo().searchText("AM"))
            article = getSolo().getText("AM");
        if (article == null && getSolo().searchText("PM"))
            article = getSolo().getText("PM");

        Assert.assertNotNull("No meeting is present on CALENDAR screen", article);

        Logger.i("Tapping on first Meeting");
        getSolo().clickOnView(article);

        return new ScreenCalendarEventDetail();
    }

    public void tapOnTodayButton() {
        Button todayButton = getSolo().getButton("Today");

        Assert.assertNotNull("No 'Today' button on CALENDAR screen", todayButton);

        ViewUtils.tapOnView(todayButton, "'Today' button");
    }

    public boolean isOnToday() {
        Calendar c = Calendar.getInstance();
        String dayOfMonth = DateFormat.format("dd", c).toString();
        String dayOfWeek = DateFormat.format("EEEE", c).toString();
        String monthYear = DateFormat.format("MMMM yyyy", c).toString();

        return getSolo().getText(dayOfMonth) != null && getSolo().getText(dayOfWeek) != null
                && getSolo().getText(monthYear) != null;
    }
}
